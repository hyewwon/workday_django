{% extends 'base.html' %}
{% load static %}
{% block main %}
<main id="main" class="main">

  <div class="pagetitle mt-2 mb-5">
    <h1>내 정보 수정</h1>
  </div><!-- End Page Title -->

  <section class="section profile">
    <div class="card">
      <div class="card-body">
        
        <div class="profile-overview" id="profile-overview" style="padding:20px;">
          <a href="{% url 'website:mypage' %}" style="float: right;">돌아가기</a>
          <h5 class="card-title">상세 정보</h5>

          <form id="editForm" onsubmit="return false;">
            <div class="row mb-3">
              <label for="user-name" class="col-sm-2 col-form-label">이름</label>
              <div class="col-sm-9">
                <input id="user-name" name="user_name" type="text" class="form-control" value="{{user.last_name}}">
                <div id="user-name-feedback" style="font-size:small"></div>
              </div>
            </div>
            <div class="row mb-3">
              <label for="department" class="col-sm-2 col-form-label">소속</label>
              <div class="col-sm-9">
                <select class="form-select" name="department_id" id="department" disabled>
                  {% for part in department %}
                    {% if part.id == user_department %}
                    <option value="{{part.id}}" selected>{{part.name}}</option>
                    {% endif %}
                    <option value="{{part.id}}">{{part.name}}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
            <div class="row mb-3">
              <label for="email" class="col-sm-2 col-form-label">이메일</label>
              <div class="col-sm-8">
                <input type="email" id="email" name="email" class="form-control" value="{{user.email}}">
                <input type="hidden" id="original_email" class="form-control" value="{{user.email}}">
                <div id="email-feedback" style="font-size:small"></div>
              </div>
              <div class="col-sm-2">
                <button class="btn btn-secondary" class="form-control" id="check-dupl-email">중복 검사</button>
              </div>
            </div>
            <div class="row mb-3">
              <label for="phone-no" class="col-sm-2 col-form-label">전화번호</label>
              <div class="col-sm-9">
                <input type="phone_no" id="phone-no" name="phone_no" class="form-control" value="{{user.profile.phone_no}}">
                <div id="phone-no-feedback" style="font-size:small"></div>
              </div>
            </div>
            <div class="row mb-5">
              <label for="note" class="col-sm-2 col-form-label">추가 정보</label>
              <div class="col-sm-9">
                <textarea class="form-control" id="note" name="note" style="height: 100px" placeholder="추가 정보를 입력해 주세요.">{{user.profile.note}}</textarea>
              </div>
            </div>
            <div class="row mb-3">
              <label for="change-password" class="col-sm-2 col-form-label">비밀번호 변경</label>
              <div class="col-sm-10">
                <button class="btn btn-outline-danger" id="btn_modal" data-bs-toggle="modal" data-bs-target="#passwordModal" onclick="resetModal();">비밀번호 변경하기</button>
              </div>
            </div>
            <div class="mb-3">
              <button class="btn btn-primary" id="btn-edit" style="float: right;" onclick="editUser();">수정 완료</button>
            </div>
          </form><!-- End General Form Elements -->

        </div>
      </div>
    </div>
  </section>

</main><!-- End #main -->

<!--비밀번호 수정 modal-->
<div id ="passwordModal"  class="modal fade" role="dialog" data-bs-backdrop="static">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document" >
      <div class="modal-content">
          <div class="modal-header">
              <h4 class="modal-title">비밀번호 변경</h4>
          </div>
          <div class="modal-body">
              <form class="row g-3 needs-validation" id="editPasswordForm" onsubmit="return false;">
                  <label for="old-password" class="col-3 col-form-label">현재 비밀번호</label>
                  <div class="col-9 p-1">
                      <input type="password" name="old_password" class="form-control" id="old-password">
                      <div class="col-11 error-comment" id="old-password-error" style="font-size:small"></div>
                  </div>
                  <label for="new-password1" class="col-3 col-form-label">새로운 비밀번호</label>
                  <div class="col-9 p-1">
                      <input type="password" name="new_password1" class="form-control" id="new-password1">
                      <div class="col-11 error-comment" id="new-password1-error" style="font-size:small"></div>
                  </div>
                  <label for="new-password2" class="col-3 col-form-label">비밀번호 확인</label>
                  <div class="col-9 p-1">
                      <input type="password" name="new_password2" class="form-control" id="new-password2">
                      <div class="col-11 error-comment" id="new-password2-error" style="font-size:small"></div>
                  </div>
              </form>   
          </div>
          <div class="modal-footer"> 
              <button class="btn btn-danger" id ="btn-password-edit" onclick="editPassword();">변경</button>
              <button class="btn btn-secondary" data-bs-dismiss="modal" id="cancel">취소</button>
          </div>
      </div>
  </div>
</div>

{% endblock main %}
{% block javascripts %}
<script src="{% static 'js/website/mypage/mypage_edit.js' %}"></script>
{% endblock javascripts %}